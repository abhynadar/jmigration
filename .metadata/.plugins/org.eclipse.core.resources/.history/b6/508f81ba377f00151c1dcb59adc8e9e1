package com.jmigration.db.jmigration;

import java.util.List;

import com.jmigration.db.jmigration.core.Version;

public abstract class Migration {
	
	Version version;
	
	public Migration() {
		super();
		this.version = migrationVersion();
	}

	JLogger logger = new JLogger();
	
	public final Boolean run(Boolean isUp, String className, List<String> tags) {
		
		Boolean returnValue = true;
		String sql = "";
		
		try {

			// TODO : Get connection object
			sql = isUp ? up() : down();
			
			logger.infoLog("Executing migration for tags %s - version number - %s and filename - %s", Utility.ToCsvString(tags), version.getVersion(), className);
			logger.infoLog(sql);
			
			if (!sql.isEmpty()) {
				// TODO : Execute upSql here
			}
			
			logger.infoLog("Successfully executed migration with version number - %s", version.getVersion());

		} catch(Exception exception) {
			returnValue = false;
			logger.errorLog(exception, "Exception occured when trying to execute migration with version number %s in class %s and sql - %s.", version.getVersion(), getClass().getName(), sql);
		}
		
		return returnValue;
	}
	
	public abstract String up();

	public abstract String down();
	
	public abstract Version migrationVersion();
	
}
