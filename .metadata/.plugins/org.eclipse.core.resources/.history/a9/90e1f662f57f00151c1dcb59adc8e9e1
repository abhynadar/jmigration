package com.jmigration.db.jmigration;

import java.util.ArrayList;
import java.util.List;

import junit.framework.Test;
import junit.framework.TestCase;
import junit.framework.TestSuite;

public class MigrationRunnerTest extends TestCase {

	public MigrationRunnerTest(String testName) {
		super(testName);
	}
	
    public static Test suite()
    {
        return new TestSuite( MigrationRunnerTest.class );
    }
    
    public void testMigrationClassListing() {
    	MigrationRunner runner = new MigrationRunner();
    	List<String> classList = runner.getMigrationClassList();
    	assertEquals(3, classList.size());
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigration1"));
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigration2"));
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigrationQA"));
    }
    
    public void testMigrationClassListingByTagsForAll() {
    	MigrationRunner runner = new MigrationRunner();
    	List<String> tags = new ArrayList<String>();
    	tags.add("ALL");
    	List<String> classList = runner.getMigrationClassListByTags(tags);
    	assertEquals(3, classList.size());
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigration1"));
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigration2"));
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigrationQA"));
    }

    public void testMigrationClassListingByTagsForDEV() {
    	MigrationRunner runner = new MigrationRunner();
    	List<String> tags = new ArrayList<String>();
    	tags.add("DEV");
    	List<String> classList = runner.getMigrationClassListByTags(tags);
    	assertEquals(2, classList.size());
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigration1"));
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigration2"));
    }

    public void testMigrationClassListingByTagsForQA() {
    	MigrationRunner runner = new MigrationRunner();
    	List<String> tags = new ArrayList<String>();
    	tags.add("QA");
    	List<String> classList = runner.getMigrationClassListByTags(tags);
    	assertEquals(2, classList.size());
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigration1"));
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigrationQA"));
    }

    public void testMigrationClassListingByTagsForDEVAndQA() {
    	MigrationRunner runner = new MigrationRunner();
    	List<String> tags = new ArrayList<String>();
    	tags.add("DEV");
    	tags.add("QA");
    	List<String> classList = runner.getMigrationClassListByTags(tags);
    	assertEquals(3, classList.size());
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigration1"));
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigration2"));
    	assertEquals(true, classList.contains("com.jmigration.db.jmigration.support.DummyMigrationQA"));
    }
    
    public void testRunMigrationClassByName(){
    	MigrationRunner runner = new MigrationRunner();
				try {
					assertTrue(runner.run(true, "com.jmigration.db.jmigration.support.DummyMigration1", null));
				} catch (ClassNotFoundException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				} catch (InstantiationException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				} catch (IllegalAccessException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
    }

    public void testScanAndRunMigrationByTagsDEV(){
    	MigrationRunner runner = new MigrationRunner();
    	List<String> tags = new ArrayList<String>();
    	tags.add("DEV");
			try {
				assertTrue(runner.scanAndRunByTags(true, tags));
			} catch (ClassNotFoundException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (InstantiationException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (IllegalAccessException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
    }
}
